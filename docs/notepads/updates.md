# 非哨兵模式
请你首先仔细分析整个仓库的功能，我也会给你介绍下目前整个仓库的功能，但你也要仔细分析。

整个仓库的功能：
是一个基于多模态VLM的智能监控系统，他具有以下功能：
1. 基于 @config.json 从监控TCP视频流每一秒里抽取每一帧图像，送去 @async_video_processor.py和 @vlm_client.py 进行推理。
2. 推理目标为 @config.json 里的 system_prompt, 即做图像理解，目标检测和回答用户问题等。
3. 还可以使用MCP，基于 @prompt.py 自动地控制摄像头云台行动，这被我们称为哨兵模式（可在前端文件夹 frontend里找到相关内容）

以上是整个仓库大概的实现的功能，尽管我提供了大概的功能描述，你也要全力去理解整个仓库的内容，充分了解它的架构和功能。

现在的问题：
1. 问题1 
## 描述
由于我们是每一秒都会抽一帧图像送入 VLM 服务进行推理，由于推理有延迟，并发量太大之后，推理服务肯定会限流，因此尽管我们在 @async_video_processor.py和 @vlm_client.py 里使用了异步的推理，但还是会很慢。
 - 比如我 第i秒的图像，会在30秒之后才有相应。
 - 比如用户针对 第i秒的图像进行了提问，如“穿蓝色衣服的人在干什么”，它会在 第i+30秒才回复，如果没有那么多的并发量，推理服务可能会在3秒内返回，但由于并发太大，被限流，所以很慢。
 
## 我的想法
**只针对 “非哨兵模式”进行更改**（非哨兵模式即不通过 MCP 自动控制摄像头云台行动过），我们不要每一帧都去进行推理，我们可以在 @config.json 里增添一个配置项，配置在非哨兵模式下，间隔多少秒才送去推理，比如间隔5秒才送去推理。
但只要有用户的输入，即user_quesiton, 那在非哨兵模式下，尽管在冷却时间内，也要送入推理。
目前我们是每秒从视频流抽一帧送给推理客户端，因此我想用最小的更改去完成这个需求，即我们仍然每一秒抽帧，但推理客户端，应该是 @vlm_client.py 和 @async_video_processor.py里，要维护一个推理调度器，去控制往推理服务发送请求的间隔，注意这是一个异步的环境，因此可能需要注意race condtion，用锁去维护等。

# 哨兵模式
请你首先仔细分析整个仓库的功能，我也会给你介绍下目前整个仓库的功能，但你也要仔细分析。

整个仓库的功能：
是一个基于多模态VLM的智能监控系统，他具有以下功能：
1. 基于 @config.json 从监控TCP视频流每一秒里抽取每一帧图像，送去 @async_video_processor.py 和 @vlm_client.py 进行推理。
2. 推理目标为 @config.json 里的 system_prompt, 即做图像理解，目标检测和回答用户问题等。
3. 还可以使用MCP，基于 @prompt.py 自动地控制摄像头云台行动，这被我们称为哨兵模式（可在前端文件夹 frontend里找到相关内容）

以上是整个仓库大概的实现的功能，尽管我提供了大概的功能描述，你也要全力去理解整个仓库的内容，充分了解它的架构和功能。

现在的问题：
1. 问题1 
## 描述
在使用哨兵模式的时候，即基于 @prompt.py 自动地控制摄像头云台行动，其遵从的指令在 @prompt.py里，历史记录的逻辑可以在 @camera_server.py 和 @camera_inference_service.py 里找到维护 mcp历史记录的逻辑。

值得注意的是我们每次只能传送当前帧的图像，历史的图像我们是无法得到的，历史图像的内容我们可能只从 "ai_assistant" 里的 <reason>why you use this tool</reason> 推测出来。
注意这里的 "ai_assistant" 里的 <reason>why you use this tool</reason> 不是 每一帧的图像理解服务里的tmp/session_*/frame_*/里的inference_result.log，而是上一次mcp server推理出的  <reason>why you use this tool</reason>，如果需要之前的图像历史记录理解，我们可以在这个 <reason>why you use this tool</reason> 里让模型补充一些信息。

我希望能够基于这些提示词，能够实现以下功能：
- 如果是一个人的话，能够通过调整焦距和摄像头云台旋转，将其移动到镜头中间，看他的全部和局部特征。
- 如果是一群人，能够通过调整焦距和摄像头云台旋转，看到整个人群，然后再使用这些工具，看每个人的特征。

但目前的历史记录维护可能信息有点少，无法支持我想实现的功能，请你仔细查看目前 mcp历史记录的维护和提示词，使得能够实现我想要的功能。

注意如果要在 @prompt.py里做 few shots，请在格式示例下，单独做一个板块告诉模型这是few shots示例。